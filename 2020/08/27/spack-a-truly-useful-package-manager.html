<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Spack: a Truly Useful Package Manager | systems++</title>
<meta name=keywords content="programming,spack,software development">
<meta name=description content="So you are developing software, and you need the software to build for multiple difference machines, with different version of a library, or with just different compile time options. You can probably manage this by hand, but it very quickly gets out of hand. Spack is a package manager designed for high performance computing, but I would argue is more broadly useful for five reasons:
 It is explicitly designed to run as an unprivileged user.">
<meta name=author content="Robert Underwood">
<link rel=canonical href=http://robertu94.github.io/2020/08/27/spack-a-truly-useful-package-manager.html>
<meta name=google-site-verification content="G-9KQE44SX6K">
<link crossorigin=anonymous href=/assets/css/stylesheet.57f29198e62b3a8f07d37acaca0427bafb684416046b823f5a616bd858bb4af1.css integrity="sha256-V/KRmOYrOo8H03rKygQnuvtoRBYEa4I/WmFr2Fi7SvE=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.baa4f2053c75d0009e9309aae8f8a8959f5e0372e88f80cdf2951a9533d71ce2.js integrity="sha256-uqTyBTx10ACekwmq6PiolZ9eA3Loj4DN8pUalTPXHOI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=http://robertu94.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=http://robertu94.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=http://robertu94.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=http://robertu94.github.io/apple-touch-icon.png>
<link rel=mask-icon href=http://robertu94.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9KQE44SX6K"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-9KQE44SX6K',{anonymize_ip:!1})}</script>
<meta property="og:title" content="Spack: a Truly Useful Package Manager">
<meta property="og:description" content="So you are developing software, and you need the software to build for multiple difference machines, with different version of a library, or with just different compile time options. You can probably manage this by hand, but it very quickly gets out of hand. Spack is a package manager designed for high performance computing, but I would argue is more broadly useful for five reasons:
 It is explicitly designed to run as an unprivileged user.">
<meta property="og:type" content="article">
<meta property="og:url" content="http://robertu94.github.io/2020/08/27/spack-a-truly-useful-package-manager.html"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2020-08-27T08:00:00-05:00">
<meta property="article:modified_time" content="2020-08-27T08:00:00-05:00"><meta property="og:site_name" content="Systems++">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Spack: a Truly Useful Package Manager">
<meta name=twitter:description content="So you are developing software, and you need the software to build for multiple difference machines, with different version of a library, or with just different compile time options. You can probably manage this by hand, but it very quickly gets out of hand. Spack is a package manager designed for high performance computing, but I would argue is more broadly useful for five reasons:
 It is explicitly designed to run as an unprivileged user.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Spack: a Truly Useful Package Manager","item":"http://robertu94.github.io/2020/08/27/spack-a-truly-useful-package-manager.html"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Spack: a Truly Useful Package Manager","name":"Spack: a Truly Useful Package Manager","description":"So you are developing software, and you need the software to build for multiple difference machines, with different version of a library, or with just different compile time options. You can probably manage this by hand, but it very quickly gets out of hand. Spack is a package manager designed for high performance computing, but I would argue is more broadly useful for five reasons:\n It is explicitly designed to run as an unprivileged user.","keywords":["programming","spack","software development"],"articleBody":"So you are developing software, and you need the software to build for multiple difference machines, with different version of a library, or with just different compile time options. You can probably manage this by hand, but it very quickly gets out of hand. Spack is a package manager designed for high performance computing, but I would argue is more broadly useful for five reasons:\n It is explicitly designed to run as an unprivileged user. This makes it much easier to install software for personal use since you won’t need sudo. It is almost trivial to create your own even private repositories, mirrors, and build caches. This makes it useful for small teams who have their own specialized software or need to operate behind the firewall. It it allows for combinatorial package management. This means that you can have multiple version of different packages all installed at the same time making it easier to try different combinations of versions. It doesn’t make assumptions about compilers or preferred build options. Like Gentoo, it allows for USE flags (called variants) that allow customization of installed packages allowing for more flexible builds. It allows for deterministic package management. Users can simply inquire of Spack, what are all of the versions of all of the packages that this package transitively depends on, and can rebuild this set of packages on demand.  It has radically transformed my work-flow and how I work and I think it will for you too. This a quick guide on how to get started with Spack.\nGetting Started Using Spack Prerequisites Spack actually doesn’t need that much to get started:\n Python A C/C++ tool-chain (doesn’t even need to be very new) A handful of very common archive management tools (i.e. tar, gzip, bzip2, xz, and zstd) A few incredibly common development dependencies (i.e. bash, patch, git, curl)  If you use a modern Linux distribution, you probably already have all of these installed. Refer to the Installation docs for up to date information\nInstalling Spack Here is a short script that I use to get started with Spack:\n#clone spack and the main repository git clone https://github.com/spack/spack source ./spack/share/spack/setup-env.sh source ./spack/share/spack/spack-completion.bash #clone and configure my personal repository of extra packages git clone https://github.com/robertu94/spack_packages robertu94_packages spack repo add ./robertu94_packages #tell spack to discover what I have installed spack compiler find spack external find Some other things you might want to do:\n Change the default number of cores used for builds Change the default target architecture (native which is faster) to something more portable (i.e. x86_64) Set some global variants options for packages Set up a mirror, build cache, or upstream instance – methods for accelerating builds.  You can find how to do these things in the docs\nUnderstanding Combinatorial Versioning With Spack it is important understand the difference between installed and loaded packages. There can be many of the versions of the same package installed; however, only one of them may be loaded at any one time.\nAdditionally, packages can differ not only by version number (i.e. 1.0, 2.1, or develop) but also by variants. Variants are “flags” that indicate that certain features should be enabled or disabled. Let’s consider an example from my repository, libpressio. libpressio has several variants: sz, zfp, mpi, libdistributed, lua, etc… You can see a list of them with:\nspack info libpressio These variants control which plugins are built for libpressio out of the large array of different available plugins. So let’s say you want to install libpressio with sz and zfp: the way to do that is:\nspack install libpressio+sz+zfp The + here refers to the variants that were explicitly enabled for this package not the dependency itself. There is also ~ which explicitly disables a variant. By default, the variants will be set to whatever the package maintainer thought was best. You can always override them in spack’s configuration later.\nOk, but what if you wanted to build SZ’s random access mode with libpressio version 0.42.1?\nspack install libpressio@0.42.1+sz+zfp ^sz+random_access Here the ^ is the “depends upon” operator. This says build version 0.42.1 of libpressio with the sz and zfp variants, and when building SZ, build the version that has the random_access variant.\nWhen you are finally ready to use it, you can load it like so:\nspack load libpressio@0.42.1 Or you can refer to it by its specific hash.\nA few other common important commands:\n spack list shows the list of available software spack find shows the list of installed software spack uninstall un-installs a version of software  Creating Your Own Spack Packages Creating and editing your own software couldn’t be easier. To create a new package simply call\nspack create -n $package_name $url_to_archive You can even pass a -N $repo_name to put it in your own personal repository\nTo edit an existing package in your $EDITOR:\nspack edit $package_name Spack strongly prefers versions be checksumed, you can do this with:\nspack checksum $package_name For me, most of the time, the defaults were exactly what I needed. If you want to learn more, checkout the official docs\nSpack is a great tool. I hope you found this to be useful!\n","wordCount":"856","inLanguage":"en","datePublished":"2020-08-27T08:00:00-05:00","dateModified":"2020-08-27T08:00:00-05:00","author":{"@type":"Person","name":"Robert Underwood"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://robertu94.github.io/2020/08/27/spack-a-truly-useful-package-manager.html"},"publisher":{"@type":"Organization","name":"systems++","logo":{"@type":"ImageObject","url":"http://robertu94.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=http://robertu94.github.io/ accesskey=h title="systems++ (Alt + H)">systems++</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=http://robertu94.github.io/about.html title="About Me">
<span>About Me</span>
</a>
</li>
<li>
<a href=http://robertu94.github.io/guides.html title=Guides>
<span>Guides</span>
</a>
</li>
<li>
<a href=http://robertu94.github.io/learning.html title="Learning To Learn">
<span>Learning To Learn</span>
</a>
</li>
<li>
<a href=http://robertu94.github.io/presentations.html title=Presentations>
<span>Presentations</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=http://robertu94.github.io/>Home</a></div>
<h1 class=post-title>
Spack: a Truly Useful Package Manager
</h1>
<div class=post-meta><span title="2020-08-27 08:00:00 -0500 -0500">August 27, 2020</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;856 words&nbsp;·&nbsp;Robert Underwood
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><nav id=TableOfContents>
<ul>
<li><a href=#getting-started-using-spack>Getting Started Using Spack</a>
<ul>
<li><a href=#prerequisites>Prerequisites</a></li>
<li><a href=#installing-spack>Installing Spack</a></li>
</ul>
</li>
<li><a href=#understanding-combinatorial-versioning>Understanding Combinatorial Versioning</a></li>
<li><a href=#creating-your-own-spack-packages>Creating Your Own Spack Packages</a></li>
</ul>
</nav>
</div>
</details>
</div>
<div class=post-content><p>So you are developing software, and you need the software to build for multiple difference machines, with different version of a library, or with just different compile time options.
You can probably manage this by hand, but it very quickly gets out of hand.
Spack is a package manager designed for high performance computing, but I would argue is more broadly useful for five reasons:</p>
<ol>
<li>It is explicitly designed to run as an unprivileged user. This makes it much easier to install software for personal use since you won&rsquo;t need sudo.</li>
<li>It is almost trivial to create your own even private repositories, mirrors, and build caches. This makes it useful for small teams who have their own specialized software or need to operate behind the firewall.</li>
<li>It it allows for combinatorial package management. This means that you can have multiple version of different packages all installed at the same time making it easier to try different combinations of versions.</li>
<li>It doesn&rsquo;t make assumptions about compilers or preferred build options. Like Gentoo, it allows for USE flags (called variants) that allow customization of installed packages allowing for more flexible builds.</li>
<li>It allows for deterministic package management. Users can simply inquire of Spack, what are all of the versions of all of the packages that this package transitively depends on, and can rebuild this set of packages on demand.</li>
</ol>
<p>It has radically transformed my work-flow and how I work and I think it will for you too. This a quick guide on how to get started with Spack.</p>
<h1 id=getting-started-using-spack>Getting Started Using Spack<a hidden class=anchor aria-hidden=true href=#getting-started-using-spack>#</a></h1>
<h2 id=prerequisites>Prerequisites<a hidden class=anchor aria-hidden=true href=#prerequisites>#</a></h2>
<p>Spack actually doesn&rsquo;t need that much to get started:</p>
<ul>
<li>Python</li>
<li>A C/C++ tool-chain (doesn&rsquo;t even need to be very new)</li>
<li>A handful of very common archive management tools (i.e. tar, gzip, bzip2, xz, and zstd)</li>
<li>A few incredibly common development dependencies (i.e. bash, patch, git, curl)</li>
</ul>
<p>If you use a modern Linux distribution, you probably already have all of these installed.
Refer to the Installation docs for <a href=https://spack.readthedocs.io/en/latest/getting_started.html>up to date information</a></p>
<h2 id=installing-spack>Installing Spack<a hidden class=anchor aria-hidden=true href=#installing-spack>#</a></h2>
<p>Here is a short script that I use to get started with Spack:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=c1>#clone spack and the main repository</span>
git clone https://github.com/spack/spack
<span class=nb>source</span> ./spack/share/spack/setup-env.sh
<span class=nb>source</span> ./spack/share/spack/spack-completion.bash

<span class=c1>#clone and configure my personal repository of extra packages</span>
git clone https://github.com/robertu94/spack_packages robertu94_packages
spack repo add ./robertu94_packages

<span class=c1>#tell spack to discover what I have installed</span>
spack compiler find
spack external find
</code></pre></div><p>Some other things you might want to do:</p>
<ul>
<li>Change the default number of cores used for builds</li>
<li>Change the default target architecture (native which is faster) to something more portable (i.e. x86_64)</li>
<li>Set some global variants options for packages</li>
<li>Set up a mirror, build cache, or upstream instance &ndash; methods for accelerating builds.</li>
</ul>
<p>You can find <a href=https://spack.readthedocs.io/en/latest/configuration.html>how to do these things in the docs</a></p>
<h1 id=understanding-combinatorial-versioning>Understanding Combinatorial Versioning<a hidden class=anchor aria-hidden=true href=#understanding-combinatorial-versioning>#</a></h1>
<p>With Spack it is important understand the difference between installed and loaded packages.
There can be many of the versions of the same package installed;
however, only one of them may be loaded at any one time.</p>
<p>Additionally, packages can differ not only by version number (i.e. 1.0, 2.1, or develop) but also by variants.
Variants are &ldquo;flags&rdquo; that indicate that certain features should be enabled or disabled.
Let&rsquo;s consider an example from my repository, libpressio.
<code>libpressio</code> has several variants: <code>sz</code>, <code>zfp</code>, <code>mpi</code>, <code>libdistributed</code>, <code>lua</code>, etc&mldr;
You can see a list of them with:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>spack info libpressio
</code></pre></div><p>These variants control which plugins are built for libpressio out of the large array of different available plugins.
So let&rsquo;s say you want to install libpressio with <code>sz</code> and <code>zfp</code>: the way to do that is:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>spack install libpressio+sz+zfp
</code></pre></div><p>The <code>+</code> here refers to the variants that were explicitly enabled for this package not the dependency itself.
There is also <code>~</code> which explicitly disables a variant.
By default, the variants will be set to whatever the package maintainer thought was best.
You can always override them in spack&rsquo;s configuration later.</p>
<p>Ok, but what if you wanted to build <code>SZ</code>&rsquo;s random access mode with libpressio version 0.42.1?</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>spack install libpressio@0.42.1+sz+zfp ^sz+random_access
</code></pre></div><p>Here the <code>^</code> is the &ldquo;depends upon&rdquo; operator.
This says build version 0.42.1 of libpressio with the sz and zfp variants, and when building <code>SZ</code>, build the version that has the <code>random_access</code> variant.</p>
<p>When you are finally ready to use it, you can load it like so:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>spack load libpressio@0.42.1
</code></pre></div><p>Or you can refer to it by its specific hash.</p>
<p>A few other common important commands:</p>
<ul>
<li><code>spack list</code> shows the list of available software</li>
<li><code>spack find</code> shows the list of installed software</li>
<li><code>spack uninstall</code> un-installs a version of software</li>
</ul>
<h1 id=creating-your-own-spack-packages>Creating Your Own Spack Packages<a hidden class=anchor aria-hidden=true href=#creating-your-own-spack-packages>#</a></h1>
<p>Creating and editing your own software couldn&rsquo;t be easier.
To create a new package simply call</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>spack create -n <span class=nv>$package_name</span> <span class=nv>$url_to_archive</span>
</code></pre></div><p>You can even pass a <code>-N $repo_name</code> to put it in your own personal repository</p>
<p>To edit an existing package in your <code>$EDITOR</code>:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>spack edit <span class=nv>$package_name</span>
</code></pre></div><p>Spack strongly prefers versions be checksumed, you can do this with:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>spack checksum <span class=nv>$package_name</span>
</code></pre></div><p>For me, most of the time, the defaults were exactly what I needed.
If you want to learn more, checkout the <a href=https://spack.readthedocs.io/en/latest/getting_started.html>official docs</a></p>
<p>Spack is a great tool.
I hope you found this to be useful!</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=http://robertu94.github.io/tags/programming.html>Programming</a></li>
<li><a href=http://robertu94.github.io/tags/spack.html>spack</a></li>
<li><a href=http://robertu94.github.io/tags/software-development.html>software development</a></li>
</ul>
<nav class=paginav>
<a class=prev href=http://robertu94.github.io/2022/07/20/thoughts-on-dependencies-for-scientific-software.html>
<span class=title>« Prev</span>
<br>
<span>Thoughts on Dependencies for Scientific Software</span>
</a>
<a class=next href=http://robertu94.github.io/2019/11/17/strong-or-robust.html>
<span class=title>Next »</span>
<br>
<span>Strong or Robust?</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2023 <a href=http://robertu94.github.io/>systems++</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>