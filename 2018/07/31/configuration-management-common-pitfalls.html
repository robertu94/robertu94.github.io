<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Configuration Management: Common Pitfalls | systems++</title>
<meta name=keywords content="Ansible,Chef,Puppet,SaltStack">
<meta name=description content="So you know you need a configuration management system and you have an idea of which one will work for you. So what should I think about about before deploying one of this systems? In this third and final post in this series, I present some suggestions about using these systems in a way that is flexible and scalable to larger numbers of systems.
Even within an operating system like Linux, there is a lot of variation between Linux distributions.">
<meta name=author content="Robert Underwood">
<link rel=canonical href=http://robertu94.github.io/2018/07/31/configuration-management-common-pitfalls.html>
<meta name=google-site-verification content="G-9KQE44SX6K">
<link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.baa4f2053c75d0009e9309aae8f8a8959f5e0372e88f80cdf2951a9533d71ce2.js integrity="sha256-uqTyBTx10ACekwmq6PiolZ9eA3Loj4DN8pUalTPXHOI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=http://robertu94.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=http://robertu94.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=http://robertu94.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=http://robertu94.github.io/apple-touch-icon.png>
<link rel=mask-icon href=http://robertu94.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9KQE44SX6K"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-9KQE44SX6K',{anonymize_ip:!1})}</script>
<meta property="og:title" content="Configuration Management: Common Pitfalls">
<meta property="og:description" content="So you know you need a configuration management system and you have an idea of which one will work for you. So what should I think about about before deploying one of this systems? In this third and final post in this series, I present some suggestions about using these systems in a way that is flexible and scalable to larger numbers of systems.
Even within an operating system like Linux, there is a lot of variation between Linux distributions.">
<meta property="og:type" content="article">
<meta property="og:url" content="http://robertu94.github.io/2018/07/31/configuration-management-common-pitfalls.html"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2018-07-31T10:00:00-05:00">
<meta property="article:modified_time" content="2018-07-31T10:00:00-05:00"><meta property="og:site_name" content="Systems++">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Configuration Management: Common Pitfalls">
<meta name=twitter:description content="So you know you need a configuration management system and you have an idea of which one will work for you. So what should I think about about before deploying one of this systems? In this third and final post in this series, I present some suggestions about using these systems in a way that is flexible and scalable to larger numbers of systems.
Even within an operating system like Linux, there is a lot of variation between Linux distributions.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Configuration Management: Common Pitfalls","item":"http://robertu94.github.io/2018/07/31/configuration-management-common-pitfalls.html"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Configuration Management: Common Pitfalls","name":"Configuration Management: Common Pitfalls","description":"So you know you need a configuration management system and you have an idea of which one will work for you. So what should I think about about before deploying one of this systems? In this third and final post in this series, I present some suggestions about using these systems in a way that is flexible and scalable to larger numbers of systems.\nEven within an operating system like Linux, there is a lot of variation between Linux distributions.","keywords":["Ansible","Chef","Puppet","SaltStack"],"articleBody":"So you know you need a configuration management system and you have an idea of which one will work for you. So what should I think about about before deploying one of this systems? In this third and final post in this series, I present some suggestions about using these systems in a way that is flexible and scalable to larger numbers of systems.\nEven within an operating system like Linux, there is a lot of variation between Linux distributions. You would be surprised how often different Linux distributions will name software, which options they will build with, what paths they expect software to be installed at, which users are expected to run the software. So if you want to support different distributions here are a few things to keep in mind:\n Try installing and getting the provisioning working on one distribution rather than multiple at first. It will help you learn the Provisioner’s tools, and it introduces substantial complexity to get this done right. So don’t add it if you don’t need it. When installing a software package, prefer to install a list of software packages. It is not uncommon for distributions to split or combine packages relative to other distributions. For example clang-query and clang are both part of the sys-devel/clang package on Gentoo but on Fedora, they are split between clang and clang-tools-extra. By installing a list of software, the list can simply include 2 packages on Fedora while only one on Gentoo. When installing a new/uncommon software package consider creating a package and serve it from a local package repository rather than building from source using the provisioner. Some distributions (looking at you CentOS) have ancient upstream package repositories (even with epel) so some newer things like neovim aren’t in the upstream repositories. Doing this isn’t too hard, and it is way easier than using a provisioner as a package build system. When installing a configuration file, consider using a variable for the path. Almost every Distribution installs configuration files into different directories. Systemd has done wonderful things standardizing this, but consider networking configuration is installed. Is it /etc/network/interfaces, /etc/sysconfig/network-scripts/* or /etc/systemd/network/*.network? It depends which Linux distribution you are using. Different Linux distributions require different users as system user accounts. For example, some distributions use the user www to serve web files, some use apache, some use httpd. In short keep in mind that you may need to support different user identities. Always test from both existing and new systems. Configuration Management that rebuilds your entire infrastructure is of no use if it does not work. Additionally it does you no good if it doesn’t respond to the updates that you intend to deliver to your systems. I would recommend using an approach similar to Chef’s kitchen with a set of VMs to manage testing. An alternative is to use containers, just be aware that certain key features of your system that you might like to manage using configuration management may not be amenable to containers. Use group vars, hiera, pillars or attributes to separate production and testing machines. One of the worst feelings that exists is when you apply a half-baked configuration module to production machines that requires you to reinstall them from scratch because you’ve bricked your login. Beware of how variable merging occurs. Each system has some concept of merging information from multiple sources, and they are almost all different and may not work the way that you would hope they would. Pay very close attention to how multiple variables get applied to the same host if it is part of conflicting groups. Manage each resources in at most one module if at all possible. The more that you split out these tasks the harder it is to debug your modules and ensure that they operate correctly. Make use of dependency management systems in the tools to ensure dependent modules execute before the modules that depend on them. Most importantly, always make changes only via the configuration management tool. Often user set changes will get overwritten later by the tool, and debugging why a hot-fix disappeared is not a problem that you want to have. This takes discipline, but its worth it – trust me.  Well that wraps up my suggestions for configuration management tools. Good luck and happy computing!\n","wordCount":"717","inLanguage":"en","datePublished":"2018-07-31T10:00:00-05:00","dateModified":"2018-07-31T10:00:00-05:00","author":{"@type":"Person","name":"Robert Underwood"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://robertu94.github.io/2018/07/31/configuration-management-common-pitfalls.html"},"publisher":{"@type":"Organization","name":"systems++","logo":{"@type":"ImageObject","url":"http://robertu94.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=http://robertu94.github.io/ accesskey=h title="systems++ (Alt + H)">systems++</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=http://robertu94.github.io/about.html title="About Me">
<span>About Me</span>
</a>
</li>
<li>
<a href=http://robertu94.github.io/guides.html title=Guides>
<span>Guides</span>
</a>
</li>
<li>
<a href=http://robertu94.github.io/learning.html title="Learning To Learn">
<span>Learning To Learn</span>
</a>
</li>
<li>
<a href=http://robertu94.github.io/presentations.html title=Presentations>
<span>Presentations</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=http://robertu94.github.io/>Home</a></div>
<h1 class=post-title>
Configuration Management: Common Pitfalls
</h1>
<div class=post-meta><span title="2018-07-31 10:00:00 -0500 -0500">July 31, 2018</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;717 words&nbsp;·&nbsp;Robert Underwood
</div>
</header>
<div class=post-content><p>So you know you need a configuration management system and you have an idea of which one will work for you.
So what should I think about about before deploying one of this systems?
In this third and final post in this series, I present some suggestions about using these systems in a way that is flexible and scalable to larger numbers of systems.</p>
<p>Even within an operating system like Linux, there is a lot of variation between Linux distributions.
You would be surprised how often different Linux distributions will name software, which options they will build with, what paths they expect software to be installed at, which users are expected to run the software.
So if you want to support different distributions here are a few things to keep in mind:</p>
<ol>
<li>Try installing and getting the provisioning working on one distribution rather than multiple at first. It will help you learn the Provisioner&rsquo;s tools, and it introduces substantial complexity to get this done right. So don&rsquo;t add it if you don&rsquo;t need it.</li>
<li>When installing a software package, prefer to install a list of software packages. It is not uncommon for distributions to split or combine packages relative to other distributions. For example <code>clang-query</code> and <code>clang</code> are both part of the <code>sys-devel/clang</code> package on Gentoo but on Fedora, they are split between <code>clang</code> and <code>clang-tools-extra</code>. By installing a list of software, the list can simply include 2 packages on Fedora while only one on Gentoo.</li>
<li>When installing a new/uncommon software package consider creating a package and serve it from a local package repository rather than building from source using the provisioner. Some distributions (looking at you CentOS) have ancient upstream package repositories (even with epel) so some newer things like <code>neovim</code> aren&rsquo;t in the upstream repositories. Doing this isn&rsquo;t too hard, and it is way easier than using a provisioner as a package build system.</li>
<li>When installing a configuration file, consider using a variable for the path. Almost every Distribution installs configuration files into different directories. Systemd has done wonderful things standardizing this, but consider networking configuration is installed. Is it <code>/etc/network/interfaces</code>, <code>/etc/sysconfig/network-scripts/*</code> or <code>/etc/systemd/network/*.network</code>? It depends which Linux distribution you are using.</li>
<li>Different Linux distributions require different users as system user accounts. For example, some distributions use the user <code>www</code> to serve web files, some use <code>apache</code>, some use <code>httpd</code>. In short keep in mind that you may need to support different user identities.</li>
<li>Always test from both existing and new systems. Configuration Management that rebuilds your entire infrastructure is of no use if it does not work. Additionally it does you no good if it doesn&rsquo;t respond to the updates that you intend to deliver to your systems. I would recommend using an approach similar to Chef&rsquo;s kitchen with a set of VMs to manage testing. An alternative is to use containers, just be aware that certain key features of your system that you might like to manage using configuration management may not be amenable to containers.</li>
<li>Use <code>group vars</code>, <code>hiera</code>, <code>pillars</code> or <code>attributes</code> to separate production and testing machines. One of the worst feelings that exists is when you apply a half-baked configuration module to production machines that requires you to reinstall them from scratch because you&rsquo;ve bricked your login.</li>
<li>Beware of how variable merging occurs. Each system has some concept of merging information from multiple sources, and they are almost all different and may not work the way that you would hope they would. Pay very close attention to how multiple variables get applied to the same host if it is part of conflicting groups.</li>
<li>Manage each resources in at most one module if at all possible. The more that you split out these tasks the harder it is to debug your modules and ensure that they operate correctly. Make use of dependency management systems in the tools to ensure dependent modules execute before the modules that depend on them.</li>
<li>Most importantly, <strong>always make changes only via the configuration management tool</strong>. Often user set changes will get overwritten later by the tool, and debugging why a hot-fix disappeared is not a problem that you want to have. This takes discipline, but its worth it &ndash; trust me.</li>
</ol>
<p>Well that wraps up my suggestions for configuration management tools. Good luck and happy computing!</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=http://robertu94.github.io/tags/ansible.html>ansible</a></li>
<li><a href=http://robertu94.github.io/tags/chef.html>Chef</a></li>
<li><a href=http://robertu94.github.io/tags/puppet.html>Puppet</a></li>
<li><a href=http://robertu94.github.io/tags/saltstack.html>SaltStack</a></li>
</ul>
<nav class=paginav>
<a class=prev href=http://robertu94.github.io/2019/04/04/julia-could-there-be-one-language.html>
<span class=title>« Prev</span>
<br>
<span>Julia: Could There be One Language?</span>
</a>
<a class=next href=http://robertu94.github.io/2018/07/31/configuration-management-the-battle-royal.html>
<span class=title>Next »</span>
<br>
<span>Configuration Management: the Battle Royal</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=http://robertu94.github.io/>systems++</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>