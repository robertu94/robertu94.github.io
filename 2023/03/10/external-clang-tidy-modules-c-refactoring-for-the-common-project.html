<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>External Clang-Tidy Modules! C++ Refactoring for the Common Project | systems++</title>
<meta name=keywords content="programming,clang-tidy,refactoring,libtooling">
<meta name=description content="Clang style refactoring has been something I&rsquo;ve been admiring from afar for quite a while now. However for a user to actually use it, it has previously required forking llvm to be able to use it in a reasonable fashion because of things like the hack in clang used to locate the resource directory or other fragile hacks like LD_PRELOAD.
Recently, the Clang/LLVM developers vastly improved the situation by allowing loadable clang-tidy modules and by installing all of the headers that you actually need to do something with clang tidy, and they are finally packaged on both Fedora and Ubuntu!">
<meta name=author content="Robert Underwood">
<link rel=canonical href=http://robertu94.github.io/2023/03/10/external-clang-tidy-modules-c-refactoring-for-the-common-project.html>
<meta name=google-site-verification content="G-9KQE44SX6K">
<link crossorigin=anonymous href=/assets/css/stylesheet.57f29198e62b3a8f07d37acaca0427bafb684416046b823f5a616bd858bb4af1.css integrity="sha256-V/KRmOYrOo8H03rKygQnuvtoRBYEa4I/WmFr2Fi7SvE=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.baa4f2053c75d0009e9309aae8f8a8959f5e0372e88f80cdf2951a9533d71ce2.js integrity="sha256-uqTyBTx10ACekwmq6PiolZ9eA3Loj4DN8pUalTPXHOI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=http://robertu94.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=http://robertu94.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=http://robertu94.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=http://robertu94.github.io/apple-touch-icon.png>
<link rel=mask-icon href=http://robertu94.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9KQE44SX6K"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-9KQE44SX6K',{anonymize_ip:!1})}</script>
<meta property="og:title" content="External Clang-Tidy Modules! C++ Refactoring for the Common Project">
<meta property="og:description" content="Clang style refactoring has been something I&rsquo;ve been admiring from afar for quite a while now. However for a user to actually use it, it has previously required forking llvm to be able to use it in a reasonable fashion because of things like the hack in clang used to locate the resource directory or other fragile hacks like LD_PRELOAD.
Recently, the Clang/LLVM developers vastly improved the situation by allowing loadable clang-tidy modules and by installing all of the headers that you actually need to do something with clang tidy, and they are finally packaged on both Fedora and Ubuntu!">
<meta property="og:type" content="article">
<meta property="og:url" content="http://robertu94.github.io/2023/03/10/external-clang-tidy-modules-c-refactoring-for-the-common-project.html"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2023-03-10T00:00:00+00:00">
<meta property="article:modified_time" content="2023-03-10T00:00:00+00:00"><meta property="og:site_name" content="Systems++">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="External Clang-Tidy Modules! C++ Refactoring for the Common Project">
<meta name=twitter:description content="Clang style refactoring has been something I&rsquo;ve been admiring from afar for quite a while now. However for a user to actually use it, it has previously required forking llvm to be able to use it in a reasonable fashion because of things like the hack in clang used to locate the resource directory or other fragile hacks like LD_PRELOAD.
Recently, the Clang/LLVM developers vastly improved the situation by allowing loadable clang-tidy modules and by installing all of the headers that you actually need to do something with clang tidy, and they are finally packaged on both Fedora and Ubuntu!">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"External Clang-Tidy Modules! C++ Refactoring for the Common Project","item":"http://robertu94.github.io/2023/03/10/external-clang-tidy-modules-c-refactoring-for-the-common-project.html"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"External Clang-Tidy Modules! C++ Refactoring for the Common Project","name":"External Clang-Tidy Modules! C\u002b\u002b Refactoring for the Common Project","description":"Clang style refactoring has been something I\u0026rsquo;ve been admiring from afar for quite a while now. However for a user to actually use it, it has previously required forking llvm to be able to use it in a reasonable fashion because of things like the hack in clang used to locate the resource directory or other fragile hacks like LD_PRELOAD.\nRecently, the Clang/LLVM developers vastly improved the situation by allowing loadable clang-tidy modules and by installing all of the headers that you actually need to do something with clang tidy, and they are finally packaged on both Fedora and Ubuntu!","keywords":["programming","clang-tidy","refactoring","libtooling"],"articleBody":"Clang style refactoring has been something I’ve been admiring from afar for quite a while now. However for a user to actually use it, it has previously required forking llvm to be able to use it in a reasonable fashion because of things like the hack in clang used to locate the resource directory or other fragile hacks like LD_PRELOAD.\nRecently, the Clang/LLVM developers vastly improved the situation by allowing loadable clang-tidy modules and by installing all of the headers that you actually need to do something with clang tidy, and they are finally packaged on both Fedora and Ubuntu!\nWhile you may think that clang-tidy modules are just for linting, they are actually a super helpful simple way to build clang based tooling that have access to most if not all of the features that you would like to have to do refactoring including\n diagnostics ast matchers fix-it hints including simple source replacement with clangTransformer compile_commands.json support and much much more  To show this off, I created this example repo which roughly follows the Clang-Tidy documentation to create the check. However, I needed to do a few small things to get things working externally:\nFirst you need to do a dance with CMake to add the appropriate build commands:\nfind_package(Clang REQUIRED)list(APPEND CMAKE_MODULE_PATH \"${CLANG_CMAKE_DIR}\")list(APPEND CMAKE_MODULE_PATH \"${LLVM_CMAKE_DIR}\")include(AddLLVM)include(AddClang)set( LLVM_LINK_COMPONENTS ${LLVM_TARGETS_TO_BUILD} Core Option Support )Which makes the cmake commands add_clang_library and clang_target_link_libraries which understand the specific linking syntax used for clang and LLVM.\nNext, you need to use these commands to create your check module:\nadd_clang_library(myclang_tidy SHARED ./src/clangtidy_libpressio.cc ./include/clangtidy_libpressio.h )clang_target_link_libraries(myclang_tidy PRIVATE clangAnalysis clangAST clangASTMatchers clangBasic clangFormat clangFrontend clangLex clangRewrite clangSema clangSerialization clangTooling clangToolingCore clangTidy clangTidyModule )I’m not sure if all of these modules are needed, but this is what clang-tidy used at the time of writing.\nThat’s it. add_clang_library adds install rules for you to install it in a reasonable place. So you are ready to write your clang-tidy check.\nHope this help!\n","wordCount":"320","inLanguage":"en","datePublished":"2023-03-10T00:00:00Z","dateModified":"2023-03-10T00:00:00Z","author":{"@type":"Person","name":"Robert Underwood"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://robertu94.github.io/2023/03/10/external-clang-tidy-modules-c-refactoring-for-the-common-project.html"},"publisher":{"@type":"Organization","name":"systems++","logo":{"@type":"ImageObject","url":"http://robertu94.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=http://robertu94.github.io/ accesskey=h title="systems++ (Alt + H)">systems++</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=http://robertu94.github.io/about.html title="About Me">
<span>About Me</span>
</a>
</li>
<li>
<a href=http://robertu94.github.io/guides.html title=Guides>
<span>Guides</span>
</a>
</li>
<li>
<a href=http://robertu94.github.io/learning.html title="Learning To Learn">
<span>Learning To Learn</span>
</a>
</li>
<li>
<a href=http://robertu94.github.io/presentations.html title=Presentations>
<span>Presentations</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=http://robertu94.github.io/>Home</a></div>
<h1 class=post-title>
External Clang-Tidy Modules! C++ Refactoring for the Common Project
</h1>
<div class=post-meta><span title="2023-03-10 00:00:00 +0000 UTC">March 10, 2023</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;320 words&nbsp;·&nbsp;Robert Underwood
</div>
</header>
<div class=post-content><p>Clang style refactoring has been something I&rsquo;ve been admiring from afar for
quite a while now. However for a user to actually use it, it has previously
required forking llvm to be able to use it in a reasonable fashion because of
things like the hack in clang used to locate the resource directory or other
fragile hacks like <code>LD_PRELOAD</code>.</p>
<p>Recently, the Clang/LLVM developers vastly improved the situation by allowing
loadable clang-tidy modules and by installing all of the headers that you
actually need to do something with clang tidy, and they are finally packaged on
both Fedora and Ubuntu!</p>
<p>While you may think that clang-tidy modules are just for linting, they are actually a
super helpful simple way to build clang based tooling that have access to most if not
all of the features that you would like to have to do refactoring including</p>
<ul>
<li>diagnostics</li>
<li>ast matchers</li>
<li>fix-it hints including simple source replacement with clangTransformer</li>
<li><code>compile_commands.json</code> support</li>
<li>and much much more</li>
</ul>
<p>To show this off, I created <a href=https://github.com/robertu94/clang-tidy-external-example>this example repo</a>
which roughly follows the <a href=https://clang.llvm.org/extra/clang-tidy/Contributing.html>Clang-Tidy</a> documentation to create the check.
However, I needed to do a few small things to get things working externally:</p>
<p>First you need to do a dance with CMake to add the appropriate build commands:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-cmake data-lang=cmake><span class=nb>find_package</span><span class=p>(</span><span class=s>Clang</span> <span class=s>REQUIRED</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>list</span><span class=p>(</span><span class=s>APPEND</span> <span class=s>CMAKE_MODULE_PATH</span> <span class=s2>&#34;${CLANG_CMAKE_DIR}&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>list</span><span class=p>(</span><span class=s>APPEND</span> <span class=s>CMAKE_MODULE_PATH</span> <span class=s2>&#34;${LLVM_CMAKE_DIR}&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>include</span><span class=p>(</span><span class=s>AddLLVM</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>include</span><span class=p>(</span><span class=s>AddClang</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>set</span><span class=p>(</span> <span class=s>LLVM_LINK_COMPONENTS</span>
  <span class=o>${</span><span class=nv>LLVM_TARGETS_TO_BUILD</span><span class=o>}</span>
  <span class=s>Core</span>
  <span class=s>Option</span>
  <span class=s>Support</span>
  <span class=p>)</span><span class=err>
</span></code></pre></div><p>Which makes the cmake commands <code>add_clang_library</code> and <code>clang_target_link_libraries</code> which understand the specific linking syntax used for clang and LLVM.</p>
<p>Next, you need to use these commands to create your check module:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-cmake data-lang=cmake><span class=nb>add_clang_library</span><span class=p>(</span><span class=s>myclang_tidy</span> <span class=s>SHARED</span>
  <span class=s>./src/clangtidy_libpressio.cc</span>
  <span class=s>./include/clangtidy_libpressio.h</span>
  <span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>clang_target_link_libraries</span><span class=p>(</span><span class=s>myclang_tidy</span>
  <span class=s>PRIVATE</span>
  <span class=s>clangAnalysis</span>
  <span class=s>clangAST</span>
  <span class=s>clangASTMatchers</span>
  <span class=s>clangBasic</span>
  <span class=s>clangFormat</span>
  <span class=s>clangFrontend</span>
  <span class=s>clangLex</span>
  <span class=s>clangRewrite</span>
  <span class=s>clangSema</span>
  <span class=s>clangSerialization</span>
  <span class=s>clangTooling</span>
  <span class=s>clangToolingCore</span>
  <span class=s>clangTidy</span>
  <span class=s>clangTidyModule</span>
  <span class=p>)</span><span class=err>
</span></code></pre></div><p>I&rsquo;m not sure if all of these modules are needed, but this is what <code>clang-tidy</code> used at the time of writing.</p>
<p>That&rsquo;s it. <code>add_clang_library</code> adds install rules for you to install it in a reasonable place.
So you are ready to write your clang-tidy check.</p>
<p>Hope this help!</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=http://robertu94.github.io/tags/programming.html>Programming</a></li>
<li><a href=http://robertu94.github.io/tags/clang-tidy.html>clang-tidy</a></li>
<li><a href=http://robertu94.github.io/tags/refactoring.html>refactoring</a></li>
<li><a href=http://robertu94.github.io/tags/libtooling.html>libtooling</a></li>
</ul>
<nav class=paginav>
<a class=prev href=http://robertu94.github.io/2023/03/14/how-i-work-the-tools-i-use.html>
<span class=title>« Prev</span>
<br>
<span>How I work: The Tools I Use</span>
</a>
<a class=next href=http://robertu94.github.io/2022/12/28/refactoring-with-clang-query.html>
<span class=title>Next »</span>
<br>
<span>Refactoring With Clang Query</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2025 <a href=http://robertu94.github.io/>systems++</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>