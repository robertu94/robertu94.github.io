<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>systems++</title>
<meta name=keywords content>
<meta name=description content="Guides A list of more &ldquo;how to&rdquo; vs &ldquo;how to learn&rdquo; documents
Recent Updates ">
<meta name=author content="Robert Underwood">
<link rel=canonical href=http://robertu94.github.io/guides.html>
<meta name=google-site-verification content="G-9KQE44SX6K">
<link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style>
<link rel=icon href=http://robertu94.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=http://robertu94.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=http://robertu94.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=http://robertu94.github.io/apple-touch-icon.png>
<link rel=mask-icon href=http://robertu94.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<link rel=alternate type=application/rss+xml href=http://robertu94.github.io/guides/index.xml>
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9KQE44SX6K"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-9KQE44SX6K',{anonymize_ip:!1})}</script>
<meta property="og:title" content>
<meta property="og:description" content="Thoughts and ramblings of a student of computer science.This site will focus on computer systems design, programming, and tricks I learn along the way.">
<meta property="og:type" content="website">
<meta property="og:url" content="http://robertu94.github.io/guides.html"><meta property="og:site_name" content="Systems++">
<meta name=twitter:card content="summary">
<meta name=twitter:title content>
<meta name=twitter:description content="Thoughts and ramblings of a student of computer science.This site will focus on computer systems design, programming, and tricks I learn along the way.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"","item":"http://robertu94.github.io/guides.html"}]}</script>
</head>
<body class=list id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=http://robertu94.github.io/ accesskey=h title="systems++ (Alt + H)">systems++</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=http://robertu94.github.io/about.html title="About Me">
<span>About Me</span>
</a>
</li>
<li>
<a href=http://robertu94.github.io/guides.html title=Guides>
<span>Guides</span>
</a>
</li>
<li>
<a href=http://robertu94.github.io/learning.html title="Learning To Learn">
<span>Learning To Learn</span>
</a>
</li>
<li>
<a href=http://robertu94.github.io/presentations.html title=Presentations>
<span>Presentations</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<div class=post-content><h1 id=guides>Guides<a hidden class=anchor aria-hidden=true href=#guides>#</a></h1>
<p>A list of more &ldquo;how to&rdquo; vs &ldquo;how to learn&rdquo; documents</p>
<h1 id=recent-updates>Recent Updates<a hidden class=anchor aria-hidden=true href=#recent-updates>#</a></h1>
</div>
<article class=post-entry>
<header class=entry-header>
<h2>Spack on Crusher
</h2>
</header>
<div class=entry-content>
<p>tl;dr Put the following in your .bashrc
use_build() { if hostname | grep summit &>/dev/null; then echo "loading crusher spack" module swap PrgEnv-cray PrgEnv-gnu module load craype-accel-amd-gfx90a module load rocm export clustername=crusher fi #other OLCF Machines export SPACK_USER_CONFIG_PATH="$HOME/.spack/$clustername" export SPACK_USER_CACHE_PATH="$SPACK_USER_CONFIG_PATH" source $HOME/git/spack-crusher/share/spack/setup-env.sh source $HOME/git/spack-crusher/share/spack/spack-completion.bash } Then run
mkdir -p ~/git git clone https://github.com/spack/spack git/spack-crusher source ~/.bashrc spack compiler find First create packages.yaml at ~/.spack/crusher/packages.yaml with:
cmake:externals:- spec:cmake@3.17.0prefix:/usrall:providers:mpi:[cray-mpich]hdf5:externals:- spec:hdf5@1.12.2+mpi+shared+hlprefix:/opt/cray/pe/hdf5-parallel/1.12.1.5/gnu/9.1buildable:Falsecray-mpich:externals:- spec:cray-mpich@8.1.16modules:[cray-mpich/8.1.16, libfabric/1.15.0.0, craype-accel-amd-gfx90a, rocm/5....</p>
</div>
<footer class=entry-footer><span title="2022-10-26 00:00:00 +0000 UTC">October 26, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;244 words&nbsp;·&nbsp;Robert Underwood</footer>
<a class=entry-link aria-label="post link to Spack on Crusher" href=http://robertu94.github.io/guides/crusher.html></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>Spack on Summit
</h2>
</header>
<div class=entry-content>
<p>tl;dr Put the following in your .bashrc
use_build() { if hostname | grep summit &>/dev/null; then echo "loading summit spack" module load gcc/10.2.0 export clustername=summit fi #other OLCF Machines export SPACK_USER_CONFIG_PATH="$HOME/.spack/$clustername" export SPACK_USER_CACHE_PATH="$SPACK_USER_CONFIG_PATH" source $HOME/git/spack-summit/share/spack/setup-env.sh source $HOME/git/spack-summit/share/spack/spack-completion.bash } Then run
mkdir -p ~/git git clone https://github.com/spack/spack git/spack-summit source ~/.bashrc spack compiler find First create packages.yaml at ~/.spack/summit/packages.yaml with:
packages:all:providers:mpi:[spectrum-mpi]openssl:externals:- spec:openssl@1.1.1cprefix:/usrbuildable:Falseopenssh:externals:- spec:openssh@8.0p1prefix:/usrbuildable:Falsecuda:externals:- spec:cuda@11.0.221prefix:/sw/summit/cuda/11.0.3buildable:Falsespectrum-mpi:externals:- spec:spectrum-mpi@10.4.0.03rtm4prefix:/sw/summit/spack-envs/base/opt/linux-rhel8-ppc64le/gcc-10.2.0/spectrum-mpi-10.4.0.3-20210112-ht5bw4jruhjujvkzcvpra5lryg5vfhy4buildable:Falsetar:externals:- spec:tar@1.30prefix:/usrcvs:externals:- spec:cvs@1.11.23prefix:/usrdiffutils:externals:- spec:diffutils@3.6prefix:/usrgroff:externals:- spec:groff@1.22.3prefix:/usrbison:externals:- spec:bison@3.0.4prefix:/usrgawk:externals:- spec:gawk@4.2.1prefix:/usrpkgconf:externals:- spec:pkgconf@1.4.2prefix:/usrm4:externals:- spec:m4@1....</p>
</div>
<footer class=entry-footer><span title="2022-10-25 00:00:00 +0000 UTC">October 25, 2022</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;210 words&nbsp;·&nbsp;Robert Underwood</footer>
<a class=entry-link aria-label="post link to Spack on Summit" href=http://robertu94.github.io/guides/summit.html></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>How to export a C API from a C++ code
</h2>
</header>
<div class=entry-content>
<p>tl;dr define a version of your API using only C compatible types in a header Do NOT include a C++ header in the transitive set of headers make the header compatible with C and C++ using #ifdef __cplusplus and extern "C" Why is this needed C++ is (mostly) a super set of C. If you want C++ to be callable from C, you need to stick to this subset for the declaring code and mark the functions as having a C ABI....</p>
</div>
<footer class=entry-footer><span title="2022-10-24 00:00:00 +0000 UTC">October 24, 2022</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;807 words&nbsp;·&nbsp;Robert Underwood</footer>
<a class=entry-link aria-label="post link to How to export a C API from a C++ code" href=http://robertu94.github.io/guides/exporting_c.html></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>How to add a dependency in CMake
</h2>
</header>
<div class=entry-content>
<p>tl;dr Most of the time simply use find_package, set CMAKE_PREFIX_PATH to include the path specified in CMAKE_INSTALL_PREFIX when the package was installed like so:
find_package(std_compat REQUIRED)target_link_libraries(my_library PUBLIC std_compat::std_compat)Tools like spack will set CMAKE_PREFIX_PATH for you. Otherwise specify it using an envionment variable or with a -D flag to cmake.
How to add the dependency Adding a dependency in CMake is pretty straight forward, but depends on where it is coming from....</p>
</div>
<footer class=entry-footer><span title="2022-10-19 00:00:00 +0000 UTC">October 19, 2022</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;579 words&nbsp;·&nbsp;Robert Underwood</footer>
<a class=entry-link aria-label="post link to How to add a dependency in CMake" href=http://robertu94.github.io/guides/cmake_deps.html></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>Updating LibPressio with Spack
</h2>
</header>
<div class=entry-content>
<p>#tl;dr
# set NEW_VERSION to the desired version cd $SPACK_ROOT git pull cd $(spack repo list | grep robertu94 | sed -E 's/robertu94[[:space:]]+//') && git pull spack install libpressio-tools ^libpressio${NEW_VERSION} spack load libpressio-tools ^libpressio${NEW_VERSION} libpressio is now Mainline LibPressio is now in the mainline version of spack (as of commit da6aeaad44e434da5563d32f2fa9900de362b2ed, October 17, 2022). You no longer need to add robertu94_packages unless you need a development version. You can either spack repo rm robertu94, or the next pull of robertu94_packages will include a dummy package to refer back to the builtin version....</p>
</div>
<footer class=entry-footer><span title="2022-09-13 00:00:00 +0000 UTC">September 13, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;406 words&nbsp;·&nbsp;Robert Underwood</footer>
<a class=entry-link aria-label="post link to Updating LibPressio with Spack" href=http://robertu94.github.io/guides/updating_libpressio_with_spack.html></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>Shortcut Guide for Configuring Spack for a New HPC System
</h2>
</header>
<div class=entry-content>
<p>Setting up spack The way that I use spack, there are 6 major steps to configuring spack:
Determine what system compiler, python, and MPI you will use Telling spack how to find your compiler Telling spack find major system dependencies such as MPI and OpenSSL as external dependencies Configuring preferred providers for virtual dependencies and target architectures Configuring spack to use a binary cache if it will matter Setting up a shell shortcut for loading spack What system dependencies to use Spack does a pretty good job “living off the land” using what ever dependencies you may need....</p>
</div>
<footer class=entry-footer><span title="2022-07-19 00:00:00 +0000 UTC">July 19, 2022</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;669 words&nbsp;·&nbsp;Robert Underwood</footer>
<a class=entry-link aria-label="post link to Shortcut Guide for Configuring Spack for a New HPC System" href=http://robertu94.github.io/guides/spack.html></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>Spack on Bebop
</h2>
</header>
<div class=entry-content>
<p>tl;dr Put the following in your .bashrc
use_build() { if hostname | grep bebop &>/dev/null; then echo "loading bebop spack" module load gcc/10.2.0-z53hda3 module load intel-mpi/2019.10.317-qn674hj module load intel-mkl/2020.4.304 source $HOME/git/spack-bebop/share/spack/setup-env.sh source $HOME/git/spack-bebop/share/spack/spack-completion.bash export clustername=bebop fi #other LCRC Machines export SPACK_USER_CONFIG_PATH="$HOME/.spack/$clustername" export SPACK_USER_CACHE_PATH="$SPACK_USER_CONFIG_PATH" } Then run
mkdir -p ~/git git clone https://github.com/spack/spack git/spack-bebop git clone https://github.com/robertu94/spack_packages git/robertu94_packages source ~/.bashrc spack compiler find # for extra packages like libpressio spack repo add ~/git/robertu94_packages First create packages....</p>
</div>
<footer class=entry-footer><span title="2022-07-19 00:00:00 +0000 UTC">July 19, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;216 words&nbsp;·&nbsp;Robert Underwood</footer>
<a class=entry-link aria-label="post link to Spack on Bebop" href=http://robertu94.github.io/guides/bebop.html></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>Spack on Cooley
</h2>
</header>
<div class=entry-content>
<p>tl;dr Put the following in your .bashrc
function use_build { # other ALCF machines if hostname | grep cooley &>/dev/null || hostname | grep cc &> /dev/null; then soft add +gcc-8.2.0 soft add +cmake-3.20.4 soft add +cuda-11.0.2 soft add +mvapich2 source ${HOME}/git/spack-cooley/share/spack/setup-env.sh export clustername=cooley fi export SPACK_USER_CONFIG_PATH="$HOME/.spack/$clustername" export SPACK_USER_CACHE_PATH="$SPACK_USER_CONFIG_PATH" } Then run
mkdir -p ~/git git clone https://github.com/spack/spack git/spack-cooley git clone https://github.com/robertu94/spack_packages git/robertu94_packages source ~/.bashrc use_build spack compiler find # for extra packages like libpressio spack repo add ~/git/robertu94_packages First create packages....</p>
</div>
<footer class=entry-footer><span title="2022-07-19 00:00:00 +0000 UTC">July 19, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;242 words&nbsp;·&nbsp;Robert Underwood</footer>
<a class=entry-link aria-label="post link to Spack on Cooley" href=http://robertu94.github.io/guides/cooley.html></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>Spack on Polaris
</h2>
</header>
<div class=entry-content>
<p>tl;dr Put the following in your .bashrc
function use_build { # other ALCF machines if hostname -f | grep polaris &>/dev/null; then echo "loading polaris spack" module swap PrgEnv-nvhpc PrgEnv-gnu module load cudatoolkit-standalone source ${HOME}/git/spack-theta/share/spack/setup-env.sh export CRAYPE_LINK_TYPE=dynamic export clustername=polaris fi export SPACK_USER_CONFIG_PATH="$HOME/.spack/$clustername" export SPACK_USER_CACHE_PATH="$SPACK_USER_CONFIG_PATH" } Then run
mkdir -p ~/git git clone https://github.com/spack/spack git/spack-polaris git clone https://github.com/robertu94/spack_packages git/robertu94_packages git clone https://github.com/mochi-hpc/mochi-spack-packages git/mochi-spack-packages source ~/.bashrc use_build spack compiler find # for extra packages like libpressio and thallium spack repo add ~/git/robertu94_packages spack repo add ~/git/mochi-spack-packages First create packages....</p>
</div>
<footer class=entry-footer><span title="2022-07-19 00:00:00 +0000 UTC">July 19, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;300 words&nbsp;·&nbsp;Robert Underwood</footer>
<a class=entry-link aria-label="post link to Spack on Polaris" href=http://robertu94.github.io/guides/polaris.html></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>Spack on Theta
</h2>
</header>
<div class=entry-content>
<p>tl;dr Put the following in your .bashrc
function use_build { # other ALCF machines if hostname | grep theta &>/dev/null; then echo "loading theta spack" module swap PrgEnv-intel PrgEnv-gnu module swap gcc/11.2.0 source ${HOME}/git/spack-theta/share/spack/setup-env.sh export CRAYPE_LINK_TYPE=dynamic export clustername=theta export HTTP_PROXY=http://theta-proxy.tmi.alcf.anl.gov:3128 export HTTPS_PROXY=http://theta-proxy.tmi.alcf.anl.gov:3128 export http_proxy=http://theta-proxy.tmi.alcf.anl.gov:3128 export https_proxy=http://theta-proxy.tmi.alcf.anl.gov:3128 fi export SPACK_USER_CONFIG_PATH="$HOME/.spack/$clustername" export SPACK_USER_CACHE_PATH="$SPACK_USER_CONFIG_PATH" } Then run
mkdir -p ~/git git clone https://github.com/spack/spack git/spack-theta git clone https://github.com/robertu94/spack_packages git/robertu94_packages git clone https://github.com/mochi-hpc/mochi-spack-packages git/mochi-spack-packages source ~/....</p>
</div>
<footer class=entry-footer><span title="2022-07-19 00:00:00 +0000 UTC">July 19, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;304 words&nbsp;·&nbsp;Robert Underwood</footer>
<a class=entry-link aria-label="post link to Spack on Theta" href=http://robertu94.github.io/guides/theta.html></a>
</article>
</main>
<footer class=footer>
<span>&copy; 2023 <a href=http://robertu94.github.io/>systems++</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>